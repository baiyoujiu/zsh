CFW.user={info:void 0,loginCallback:$.no,account:{balance:null,borrowRebate:null,loanRebate:null},isLogin:function(c,b){CFW.ajax(ctx.sso+"/check.html",{balance:!0},function(a){a&&a.authenticated&&(c(a),b&&CFW.user.loadPageHeader())})},getUserId:function(){return $.getCookie("userId",null)},getUsername:function(){return $.getCookie("username",null)},clearUserCookie:function(){$.delCookie("userId","/",CFW.domain);$.delCookie("username","/",CFW.domain)},checkAndShowLogin:function(c){if(this.isLogin())return CFW.user.loadPageHeader(),!0;this.login(function(){CFW.user.loginCallback&&CFW.user.loginCallback();c&&c()});return!1},loadBalance:function(c){CFW.ajax(ctx.account+"/getbalance",null,function(b){if(b.isSuccess&&(CFW.user.account.balance=/^\d{1,}(.\d{1,})?$/.test(b.responseObj.balance)?parseFloat(b.responseObj.balance):0,CFW.user.account.borrowRebate=/^\d{1,}(.\d{1,})?$/.test(b.responseObj.borrowRebate)?Math.floor(parseFloat(b.responseObj.borrowRebate)):0,CFW.user.account.loanRebate=/^\d{1,}(.\d{1,})?$/.test(b.responseObj.loanRebate)?Math.floor(parseFloat(b.responseObj.loanRebate)):0,c)){var a={};a.balance=CFW.user.account.balance;a.balanceFormal=b.balanceFormal;a.borrowRebate=CFW.user.account.borrowRebate;a.loanRebate=CFW.user.account.loanRebate;c(a)}})},loadPageHeader:function(c){if(1!==$("input[name\x3dheadlogin]").length||"1"!==$("input[name\x3dheadlogin]").val())CFW.user.info||$.get(ctx.sso+"/getheaderinfo",{t:(new Date).getTime()},function(b){if(b.isSuccess){CFW.user.info=b.responseObj;$.setCookie("userId",CFW.user.info.userId,null,null,CFW.domain);b="";0===CFW.user.info.messageCount&&(b=" zero");var a=[];a.push('\x3cli\x3e\x3ca href\x3d"/my"\x3e\u60a8\u597d\uff01\x3cstrong\x3e');a.push(CFW.user.info.userName);a.push("\x3c/strong\x3e\x3c/a\x3e\x3c/li\x3e");a.push('\x3cli\x3e\x3ca href\x3d"/service/sitemessage"\x3e\u6d88\u606f\x3cspan class\x3d"message');a.push(b);a.push('"\x3e');a.push(CFW.user.info.messageCount);a.push("\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e");a.push('\x3cli\x3e\x3ca href\x3d"/pass/logout?s\x3dhome"\x3e\u9000\u51fa\x3c/a\x3e\x3c/li\x3e');$(".top_nav_list .info").empty().html(a.join(""));$(".top_nav_list .info").before('\x3cinput type\x3d"hidden" name\x3d"headlogin" value\x3d"1"/\x3e');100<=CFW.user.info.messageCount&&$(".top_nav_list .info").find(".message").css("width",$(".top_nav_list .info").find(".message").width()+6*(CFW.user.info.messageCount.toString().length-2));c&&c()}else CFW.dialog.alert(b.message,1)},"json")},vcodeDialog:function(c){var b=CFW.dialog,a=new Text;a._('\x3cdiv class\x3d"login-box"\x3e');a._('\x3cdiv class\x3d"login-box-in"\x3e\x3cspan\x3e\x3c/span\x3e\x3cinput class \x3d "input-text-style-3 input-v-code"  autocomplete \x3d "off" name\x3d"vcode" id\x3d"vcode"\x3e\x3cimg class\x3d"vcode-img" src\x3d"/pass/validatecode" id\x3d"vCodeImg" /\x3e\x3cspan class\x3d"input-tips pointer"\x3e\x3ca href\x3d"javascript:;" onclick\x3d"refreshVcode()"\x3e\u770b\u4e0d\u6e05\uff1f\u70b9\u51fb\u6362\u4e00\u5f20\x3c/a\x3e\x3c/div\x3e');a._("\x3c/div\x3e");a._('\x3cdiv class\x3d"login-box-in" style\x3d"padding-bottom:20px"\x3e\x3cinput id\x3d"check-btn" type\x3d"button" class\x3d"btn btn-xl" dis-text\x3d"\u9a8c\u8bc1\u4e2d..." onclick\x3d"CFW.dialog.listener(#di#,1);" value\x3d"\u786e\u5b9a"/\x3e\x3c/div\x3e');b.open(a.ts(),{topic:"\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801",width:354,listener:function(a){var e=$("#vcode").val();0==e.length&&b.alert("\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801",0);CFW.form.disableBtn("check-btn");CFW.ajax("/pass/AjaxCheckVCode",{vcode:e},function(a){a.success?c(e):b.alert(a.msg,0)})}})},login:function(c){var b=CFW.dialog,a=CFW.form,d=new Text,e=$.trim($.getCookie("CFW-NAME"));d._('\x3cdiv class\x3d"login-box"\x3e');d._('\x3cdiv class\x3d"login-box-in"\x3e\x3cinput id\x3d"username" type\x3d"text" class\x3d"lui-input"\x3e\x3cspan class\x3d"icon head"\x3e\x3c/span\x3e')._(""==e?"":'\x3cdiv class\x3d"login-clear" onClick\x3d"CFW.user.clear();"\x3e\x3c/div\x3e')._("\x3c/div\x3e");d._('\x3cdiv class\x3d"login-box-in"\x3e\x3cinput id\x3d"password" type\x3d"password" class\x3d"lui-input-pwd"\x3e\x3cspan class\x3d"icon lock"\x3e\x3c/span\x3e\x3c/div\x3e');d._("\x3c/div\x3e");d._('\x3cdiv class\x3d"login-box-in" style\x3d"padding-bottom:20px"\x3e\x3cinput id\x3d"login-btn" type\x3d"button" class\x3d"btn btn-xl" dis-text\x3d"\u767b\u5f55\u4e2d..." onclick\x3d"CFW.dialog.listener(#di#,1);" value\x3d"\u767b \u5f55"/\x3e\x3c/div\x3e');d._('\x3cdiv style\x3d"line-height:100%; padding:0px 20px;"\x3e\x3ca href\x3d"')._(ctx.sso)._('/check/forgetPwd.html" class\x3d"fr"\x3e\u5fd8\u8bb0\u5bc6\u7801\x3c/a\x3e\x3ca href\x3d"')._(ctx.sso)._('/check/register.html"\x3e\u514d\u8d39\u6ce8\u518c\x3c/a\x3e\x3c/div\x3e');b.open(d.ts(),{topic:"\u7528\u6237\u767b\u5f55",width:354,listener:function(a){if(0!=a){var d=$("#username"),e=$("#password");a=$("#login");var g=$.v(d),h=$.v(e);$.v(a);"\u7528\u6237\u540d"==g||0==g.length?b.alert("\u8bf7\u586b\u5199\u7528\u6237\u540d\u3001\u624b\u673a\u53f7\u6216\u90ae\u7bb1",0,{listener:function(){d.f()}}):0==h.length?b.alert("\u8bf7\u8f93\u5165\u767b\u5f55\u5bc6\u7801",0,{listener:function(){e.f()}}):(CFW.form.disableBtn("login-btn"),CFW.ajax(ctx.sso+"/check/login.html",{userName:g,password:h,remeber:!0},function(a){a=$.parseJSON(a);(a.status== 200)?(window.location.reload()):(CFW.form.enableBtn("login-btn"),b.alert(a.msg,1,{listener:function(){d.f()}}))}))}}});$.v("username",e);a.inputR("username","\u7528\u6237\u540d");a.inputPw("password",!0);$("#username").keyup(function(a){13==a.keyCode&&$("#password").focus()});$("#password").keyup(function(a){13==a.keyCode&&$("#login-btn").click()});""==e?$("#username").focus():$("#password").focus()},clear:function(){$(".login-clear").remove();$("#username").val("").focus();$.delCookie("CFW-NAME","/",CFW.domain)},register:function(c){1==c?checkNickName(function(b){b&&checkPwd()&&checkPwdSure()&&("checked"!=$("#agreeBox").attr("checked")?CFW.dialog.alert("\u8bf7\u5148\u9605\u8bfb\u5e76\u540c\u610f\u8d62\u5728\u6295\u8d44\u7f51\u7ad9\u670d\u52a1\u534f\u8bae",1):(CFW.form.disableBtn("surebtn"),CFW.ajax(ctx.sso+"/check/register.html",{action:"validateStep1",username:$("#username").val(),password:$("#password").val(),type:$("#role").val()},function(a){a=$.parseJSON(a);a.success?$("#regForm").submit():(CFW.form.enableBtn("surebtn"),CFW.dialog.alert(a.resultMsg,1))})))}):2==c&&checkMobile(function(b){if(b&&checkVCode()){b=$("#mobile");var a=$.v(b),c=$("#vCode");b=$.v(c);var e=$("#reg-b-tips");CFW.form.disableBtn("sure");CFW.ajax(ctx.sso+"/check/register.html",{action:"checkRegisterCode",mobile:a,checkCode:b},function(b){b=$.parseJSON(b);b.success?CFW.ajax(ctx.sso+"/check/register.html",{action:"doRegister",mobile:a,username:$("#username").val(),password:$("#password").val(),type:$("#type").val()},function(a){a=$.parseJSON(a);a.success?window.location.href=ctx.sso+"/check/register.html?action\x3dhappy":(CFW.form.enableBtn("sure"),CFW.dialog.alert(a.resultMsg,1))}):(CFW.form.enableBtn("sure"),e.html('\x3cem class\x3d"icon"\x3e\x3c/em\x3e'+b.resultMsg),c.addClass("error"))})}})},getRegCheckCode:function(){checkMobile(function(c){if(c){var b=CFW.dialog;c=new Text;c._('\x3cdiv class\x3d"db-con"\x3e');c._('\x3cdiv class\x3d"lui-form-item"\x3e\x3clabel class\x3d"lui-label"\x3e\u9a8c\u8bc1\u7801\x3c/label\x3e\x3cinput id\x3d"checkCode" type\x3d"text" maxlength\x3d"4" class\x3d"lui-input" style\x3d"width:120px;"\x3e');c._('\x3cimg id\x3d"checkCodeImg" src\x3d"'+ctx.sso+'/checkCode.htm" width\x3d"100" height\x3d"25" align\x3d"absmiddle" style\x3d"margin-left:19px; cursor:pointer;" onclick\x3d"$(this).attr(\'src\',\''+ctx.sso+"/checkCode.htm?t\x3d'+new Date());\"\x3e\x3c/div\x3e");c._('\x3cdiv class\x3d"lui-form-item" style\x3d"padding-top:10px; padding-bottom:10px;"\x3e\x3cinput type\x3d"button" id\x3d"sure" onclick\x3d"CFW.dialog.listener(#di#,1);" class\x3d"btn btn-l" value\x3d"\u786e\u5b9a"/\x3e\x3c/div\x3e');c._("\x3c/div\x3e");b.open(c.ts(),{topic:"\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801",width:450,listener:function(a){if(1==a){a=$.v("checkCode");$.trim($("#idNumber").val()).toUpperCase();if(""==a)return CFW.dialog.alert("\u8bf7\u8f93\u5165\u56fe\u7247\u4e2d\u7684\u9a8c\u8bc1\u7801",1,{listener:function(){$("#checkCode").focus()}}),!1;$.post(ctx.sso+"/check/register.html",{action:"getRegisterCode",mobile:$("#mobile").val(),checkCode:a},function(a){a.success?(b.close(),CFW.form.timeoutBtn("regCodeBtn","{time}\u79d2\u540e\u91cd\u65b0\u83b7\u53d6",60)):(CFW.form.timeoutBtnBreak("regCodeBtn"),CFW.code.notifyInterval==$.trim(a.code)?CFW.form.timeoutBtn("regCodeBtn","{time}\u79d2\u540e\u91cd\u65b0\u83b7\u53d6",a.interval):(CFW.dialog.alert(a.resultMsg,1,{listener:function(){$("#checkCode").focus()}}),$("#checkCodeImg").attr("src",ctx.sso+"/checkCode.htm")))},"json")}}})}})},initReg:function(c){var b=CFW.form,a=$(window).height();1==c?(b.inputR("username","\u7528\u6237\u540d"),b.inputPw("password",""),b.inputPw("passsure","-s")):2==c?(b.inputR("mobile","\u624b\u673a\u53f7"),b.inputR("vCode","\u9a8c\u8bc1\u7801")):3==c&&$(".reg-wrap-out").height(560<a?a-160:400)},loginPage:function(){var c=$("#username"),b=$("#password"),a=$.v(c),d=$.v(b),e=$("#login-tips");$("#login-btn");if(0==$.clear(a).length||"\u7528\u6237\u540d/\u624b\u673a\u53f7/\u90ae\u7bb1"==a)return e.htm("\u8bf7\u8f93\u5165\u7528\u6237\u540d/\u624b\u673a\u53f7/\u90ae\u7bb1"),c.addClass("error").focus(),!1;if(0==$.clear(d).length)return e.htm("\u8bf7\u8f93\u5165\u767b\u5f55\u5bc6\u7801"),b.addClass("error").focus(),!1;CFW.form.disableBtn("login-btn");CFW.ajax(ctx.sso+"/yztz_user_login_check",{username:a,password:d,remeber:!0,entrance:$.v("entrance"),authencationType:"AJAX"},function(a){a=$.parseJSON(a);a.authenticated?window.location.href=a.entrance:(CFW.form.enableBtn("login-btn"),e.htm(a.resultMsg))})},loginPageInit:function(){var c=CFW.form;$(".login-con-wrap").find("p.tip-text");$("#username");var b=$.trim($.getCookie("CFW-NAME"));c.inputR("username","\u7528\u6237\u540d/\u624b\u673a\u53f7/\u90ae\u7bb1");c.inputPw("password","");""!=b?($.v("username",b),$("#username").blur(),$("#password").focus()):($(".login-clear").remove(),$("#username").focus());$("#username").keyup(function(a){13==a.keyCode&&$("#password").focus()});$("#password").keyup(function(a){13==a.keyCode&&$("#login-btn").click()})},getForgetCheckCode:function(){var c=$("#mobile"),b=$.v(c),a=$("#forget-a-tips");checkMobile()&&(CFW.form.timeoutBtn("forgetPwdGetCode","{time}\u79d2\u540e\u91cd\u65b0\u83b7\u53d6",60),CFW.ajax(ctx.sso+"/forget.htm",{action:"forgetCode",mobile:b},function(b){b=$.parseJSON(b);b.success||(CFW.form.timeoutBtnBreak("forgetPwdGetCode"),CFW.code.notifyInterval==$.trim(b.code)?CFW.form.timeoutBtn("forgetPwdGetCode","{time}\u79d2\u540e\u91cd\u65b0\u83b7\u53d6",b.interval):(a.html('\x3cem class\x3d"icon"\x3e\x3c/em\x3e'+b.resultMsg),c.addClass("error")))}))},forget:function(c){if(1==c){c=$("#mobile");c=$.v(c);var b=$("#vCode"),a=$.v(b),d=$("#forget-b-tips");checkMobile()&&checkVCode()&&(CFW.form.disableBtn("nextbtn"),CFW.ajax(ctx.sso+"/forget.htm",{action:"checkCode",checkCode:a,mobile:c},function(a){a=$.parseJSON(a);a.success?window.location.href=ctx.sso+"/forget.htm?action\x3dstep2":(CFW.form.enableBtn("nextbtn"),d.html('\x3cem class\x3d"icon"\x3e\x3c/em\x3e'+a.resultMsg),b.addClass("error"))}))}else 2==c&&(c=$("#password"),c=$.v(c),a=$("#passsure"),$.v(a),$("#forget-a-tips"),d=$("#forget-b-tips"),new Text,checkPassword()&&checkPasssure()&&(CFW.form.disableBtn("nextbtn"),CFW.ajax(ctx.sso+"/forget.htm",{action:"resetForgetPassword",mobile:$.v("mobile"),password:c},function(a){a=$.parseJSON(a);a.success?window.location=ctx.sso+"/forget.htm?action\x3dhappy":(CFW.form.enableBtn("nextbtn"),CFW.dialog.alert(a.resultMsg,3))})))},initForget:function(c){var b=CFW.form;$(window).height();1==c?(b.inputR("mobile","\u624b\u673a\u53f7"),b.inputR("vCode","\u9a8c\u8bc1\u7801")):2==c&&(b.inputPw("password","-n"),b.inputPw("passsure","-s"))},loadLoginPageH:function(){var c=$(window).height();570<c&&$("div.login-wrap-out").css({padding:(c-570)/2+1+"px 20px"})},bbs:function(){var c=CFW.dialog,b=CFW.form,a=new Text;a._('\x3cdiv class\x3d"db-con-0"\x3e');a._('\x3cdiv class\x3d"lui-form-item"\x3e\x3cselect id\x3d"type" class\x3d"sel-b" style\x3d"width:340px;"\x3e');a._("\x3coption\x3e\u610f\u89c1\u53cd\u9988\x3c/option\x3e\x3coption\x3e\u805a\u5b9d\u76c6\u95ee\u9898\x3c/option\x3e\x3coption\x3e\u80a1\u7968\u914d\u8d44\u95ee\u9898\x3c/option\x3e");a._("\x3coption\x3e\u529f\u80fd\u4f7f\u7528\u95ee\u9898\x3c/option\x3e\x3coption\x3e\u5176\u4ed6\u95ee\u9898\x3c/option\x3e\x3c/select\x3e\x3c/div\x3e");a._('\x3cdiv class\x3d"lui-form-item"\x3e\x3cinput id\x3d"contact" type\x3d"text" class\x3d"lui-input" style\x3d"width:328px;"/\x3e\x3c/div\x3e');a._('\x3cdiv class\x3d"lui-form-item"\x3e\x3ctextarea id\x3d"content" style\x3d"width:328px;height:96px;color:#666666;padding:5px;"\x3e\u8bf7\u586b\u5199\u7559\u8a00\u5185\u5bb9\x3c/textarea\x3e\x3c/div\x3e');a._('\x3cdiv class\x3d"lui-form-item" style\x3d"padding-top:10px; padding-bottom:10px;"\x3e\x3ca href\x3d"#" onclick\x3d"CFW.dialog.listener(#di#,1);" class\x3d"btn btn-l"\x3e\u63d0\u4ea4\x3c/a\x3e\x3c/div\x3e');a._("\x3c/div\x3e");c.open(a.ts(),{topic:"\u586b\u5199\u7559\u8a00\u5185\u5bb9",width:450,listener:function(a){if(1==a){a=$.v("type");var b=$.v("content"),f=$.v("contact"),f="\u8bf7\u8f93\u5165\u624b\u673a\u53f7\u6216\u90ae\u7bb1"==f?"":f,b="\u8bf7\u586b\u5199\u7559\u8a00\u5185\u5bb9"==b?"":b;""==a?CFW.dialog.alert("\u8bf7\u9009\u62e9\u7559\u8a00\u7c7b\u578b",1):""==f?CFW.dialog.alert("\u8bf7\u586b\u5199\u8054\u7cfb\u65b9\u5f0f",1,{listener:function(){$("#contact").focus()}}):/^1[3-9]\d{9}$/.test(f)||/^[0-9a-zA-Z\-_]+@[0-9a-zA-Z\-_]+\.\w{1,5}(\.\w{1,5})?$/.test(f)?20<$.trim(f).length?CFW.dialog.alert("\u8054\u7cfb\u65b9\u5f0f\u5fc5\u987b\u572820\u4e2a\u5b57\u4ee5\u5185",1,{listener:function(){$("#contact").focus()}}):""==b?CFW.dialog.alert("\u8bf7\u586b\u5199\u7559\u8a00\u5185\u5bb9",1,{listener:function(){$("#content").focus()}}):3E3<b.length?CFW.dialog.alert("\u7559\u8a00\u5185\u5bb9\u8bf7\u63a7\u5236\u57283000\u5b57\u4ee5\u5185",1,{listener:function(){$("#content").focus()}}):($("#subButton").attr("disabled",!0).val("\u63d0\u4ea4\u4e2d..."),CFW.ajax(ctx.user+"/anonyMessager.htm",{action:"postMsg",type:a,content:b,contact:f},function(a){$("#subButton").attr("disabled",!1).val("\u63d0\u4ea4");a=$.parseJSON(a);a.success?(c.close(),CFW.dialog.alert("\u7559\u8a00\u6210\u529f",4)):CFW.dialog.alert(a.resultMsg,3)})):CFW.dialog.alert("\u8054\u7cfb\u65b9\u5f0f\u5fc5\u987b\u662f\u624b\u673a\u6216\u8005\u90ae\u7bb1",1,{listener:function(){$("#contact").focus()}})}}});b.inputR("contact","\u8bf7\u8f93\u5165\u624b\u673a\u53f7\u6216\u90ae\u7bb1");b.inputR("content","\u8bf7\u586b\u5199\u7559\u8a00\u5185\u5bb9");$("#contact").focus()}};